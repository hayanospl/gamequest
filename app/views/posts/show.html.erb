<h1>投稿詳細ページ</h1>
<h3>投稿者: <%= @post.user.name %></h3>
<h3>本文: <%= @post.content %></h3>
<% if @post.image? %>
  <% if @post.image.file.content_type.include?('image/') %>
    <%= image_tag @post.image.url(:thumb) %>
  <% else %>
    <%= video_tag @post.image.url, width: "30%", height: "30%", controls: true, autobuffer: true %>
  <% end %>
<% end %>

<% @post.tag_list.each do |tag| %>
  <%= link_to tag, root_path(tag_name: tag) %>
<% end %>

<div id="likes_buttons_<%= @post.id %>">
  <%= render 'shared/likes', locals: { post: @post }%>
</div>

<p><span>投稿のいいね数: </span><%= @post.likes.count %></p></br>

<% if @post.user_id == current_user.id %>
  <%= link_to '削除', post_path(post_id: @post.id), method: :delete %>
<% end %>

<h2>コメント一覧</h2>
<% @post.comments.each do |c| %>
  <div>
    <h5>ユーザー名 <%= c.user.name %></h5>
    <h5>コメント <%= c.content %></h5>
    <% if c.image? %>
      <% if c.image.file.content_type.include?('image/') %>
        <%= image_tag c.image.url(:thumb) %>
      <% else %>
        <%= video_tag c.image.url, width: "30%", height: "30%", controls: true, autobuffer: true %>
      <% end %>
    <% end %>

    <div id="commentlikes_buttons_<%= c.id %>">
      <%= render partial: 'shared/commentlikes', locals: { c: c }%>
    </div>

    <p><span>コメントのいいね数: </span><%= c.comment_likes.count %></p>
    
    <% if c.user_id == current_user.id %>
      <%= link_to '削除', post_comment_path(post_id: @post.id, comment_id: c.id), method: :delete %></br>
    <% end %>
    --------------------------------
  </div>
<% end %>

<%= form_with(model: [@post, @comment], local: true) do |f| %>
  <%= f.text_field :content %><br>
  <%= f.file_field :image, accept: 'image/jpeg, image/gif, image/png, video/*'%></br>
  <%= f.submit 'コメントする' %>
<% end %>

<%= link_to "ホームへ戻る", root_path %>
