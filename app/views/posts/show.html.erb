<h1>投稿詳細ページ</h1>
<h3>投稿者: <%= @post.user.name %></h3>
<h3>本文: <%= @post.content %></h3>
<% if @post.image? %>
  <% if @post.image.file.content_type.include?('image/') %>
    <%= image_tag @post.image.url(:thumb) %>
  <% else %>
    <%= video_tag @post.image.url, width: "30%", height: "30%", controls: true, autobuffer: true %>
  <% end %>
<% end %>

<% if @post.liked_by?(current_user) %>
  <p><span >いいね解除: </span>♡<%= link_to @post.likes.count, post_like_path(@post.id), method: :delete, class: "text-danger" %></p>
<% else %>
  <p><span>いいね: </span>♡<%= link_to @post.likes.count, post_likes_path(@post.id), method: :post, class: "text-secondary"  %></p>
<% end %>

<p><span>投稿のいいね数: </span><%= @post.likes.count %></p>


<h2>コメント一覧</h2>
<% @post.comments.each do |c| %>
  <div>
    <h5>ユーザー名 <%= c.user.name %></h5>
    <h5>コメント <%= c.content %></h5>
    <% if c.image? %>
      <% if c.image.file.content_type.include?('image/') %>
        <%= image_tag c.image.url(:thumb) %>
      <% else %>
        <%= video_tag c.image.url, width: "30%", height: "30%", controls: true, autobuffer: true %>
      <% end %>
    <% end %>

    <% if c.comment_liked_by?(current_user) %>
      <p><span >いいね解除: </span>♡<%= link_to c.comment_likes.count, post_comment_comment_like_path(post_id: @post.id, comment_id: c.id), method: :delete, class: "text-danger" %></p>
    <% else %>
      <p><span>いいね: </span>♡<%= link_to c.comment_likes.count, post_comment_comment_likes_path(post_id: @post.id, comment_id: c.id), method: :post, class: "text-secondary"  %></p>
    <% end %>
    <p><span>コメントのいいね数: </span><%= c.comment_likes.count %></p>
    --------------------------------
  </div>
<% end %>

<%= form_with(model: [@post, @comment], local: true) do |f| %>
  <%= f.text_field :content %><br>
  <%= f.file_field :image, accept: 'image/jpeg, image/gif, image/png, video/*'%></br>
  <%= f.submit 'コメントする' %>
<% end %>

<%= link_to "ホームへ戻る", root_path %>
